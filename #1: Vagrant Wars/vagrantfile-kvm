require 'json'

Vagrant.configure("2") do |config|
  DEFAULT_BOX = "generic/ubuntu2004"
  CPU_CORES = 2
  MEMORY = 1024

  # Caminho para o arquivo de credenciais no Linux
  credentials_path = "STORAGE_LOCATION/smb_credentials.json"
  if File.exist?(credentials_path)
    credentials = JSON.parse(File.read(credentials_path))
    smb_username = credentials['username']
    smb_password = credentials['password']
  else
    raise "Arquivo de credenciais n√£o encontrado: #{credentials_path}"
  end

  servers = [
    { hostname: :ad },
    { hostname: :database },
    { hostname: :scenter }
  ]

  servers.each do |machine|
    config.vm.define machine[:hostname] do |node|
      node.vm.box = DEFAULT_BOX
      node.vm.hostname = machine[:hostname].to_s
      node.vm.network :private_network
      node.vm.synced_folder '.', '/vagrant', type: 'smb', smb_username: smb_username, smb_password: smb_password

      node.vm.provider :libvirt do |lv|
        lv.cpus = CPU_CORES
        lv.memory = MEMORY
      end
    end
  end
end
